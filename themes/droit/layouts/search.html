{{ define "main" }}
<div class="max-w-3xl mx-auto p-8 bg-white text-near-black">
    <h1 class="font-barlow text-3xl font-bold text-navy mb-6">Search</h1>

    <div class="mb-8">
        <input type="search" id="search-input" name="q" placeholder="Search posts, tags, content..." class="w-full border border-gray-300 rounded px-4 py-2 text-base focus:outline-none focus:border-navy bg-white text-near-black" autocomplete="off" />
    </div>

    <div id="search-results" class="space-y-6"></div>
</div>

<!-- We will add JavaScript for search functionality later -->
<!-- It's often good practice to include JS at the end of the body -->
<!-- For example, linking to a /js/search.js file or embedding it -->

<script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0"></script>
<script>
const searchInput = document.getElementById('search-input');
const resultsDiv = document.getElementById('search-results');
let fuse;
let indexData;
fetch('/searchindex.json')
  .then(res => res.json())
  .then(data => {
    indexData = data;
    fuse = new Fuse(data, {
      keys: ['title', 'summary', 'content', 'tags', 'categories'],
      threshold: 0.3,
      ignoreLocation: true,
      minMatchCharLength: 2,
    });
  });
function renderResults(results) {
  if (!results || results.length === 0) {
    resultsDiv.innerHTML = '<div class="text-near-black/60">No results found.</div>';
    return;
  }
  resultsDiv.innerHTML = results.map(r => {
    const item = r.item || r;
    return `<div class="border-b border-gray-200 pb-4">
      <a href="${item.permalink}" class="text-xl font-semibold text-navy hover:underline">${item.title}</a>
      <div class="text-sm text-near-black/70 mb-1">${(item.tags||[]).map(t=>`<span class='mr-2'>#${t}</span>`).join('')}</div>
      <div class="text-base text-near-black/90">${item.summary || ''}</div>
    </div>`;
  }).join('');
}
searchInput.addEventListener('input', function(e) {
  const q = e.target.value.trim();
  if (!q) {
    resultsDiv.innerHTML = '';
    return;
  }
  const results = fuse.search(q);
  renderResults(results);
});
</script>
{{ end }}
